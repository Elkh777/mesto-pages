(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"87e5607f-6be9-4cbe-a478-d5f95d4ed19d","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),z=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),te=e=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify(e)}).then(u),ne=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify(e)}).then(u),oe=e=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify(e)}).then(u),re=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),se=(e,t)=>{const n=t?"DELETE":"PUT";return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:n,headers:c.headers}).then(u)},ce=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),H=(e,t,n)=>{const{handleLikeClick:o,handleDeleteClick:r,handleImageClick:s,handleInfoClick:i}=t,l=ce(),d=l.querySelector(".card__image"),h=l.querySelector(".card__title"),_=l.querySelector(".card__like-button"),O=l.querySelector(".card__like-count"),F=l.querySelector(".card__control-button_type_delete"),N=l.querySelector(".card__control-button_type_info");return d.src=e.link,d.alt=e.name,h.textContent=e.name,O.textContent=e.likes.length,e.owner._id!==n&&F.remove(),e.likes.some(E=>E._id===n)&&_.classList.add("card__like-button_is-active"),o&&_.addEventListener("click",()=>{o(e._id,_,O)}),r&&e.owner._id===n&&F.addEventListener("click",()=>{r(e._id,l)}),s&&d.addEventListener("click",()=>{s({name:e.name,link:e.link})}),i&&N&&N.addEventListener("click",E=>{E.stopPropagation(),i(e._id)}),l},J=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",J)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",J)},le=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&p(e)})};function S(e,t,n,o){const r=e.querySelector(`#${t.id}-error`);r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}function V(e,t,n){const o=e.querySelector(`#${t.id}-error`);o.textContent="",o.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass)}function ie(e,t,n){if(!t.value.trim()){S(e,t,"Заполните это поле",n);return}const o=t.classList.contains("popup__input_type_name"),r=t.classList.contains("popup__input_type_card-name"),s=t.classList.contains("popup__input_type_description"),i=t.classList.contains("popup__input_type_url"),l=2,d=o?40:r?30:s?200:1/0;if(t.value.length<l||t.value.length>d){S(e,t,o||r?"От 2 до 30 символов":"От 2 до 200 символов",n);return}if((o||r)&&!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(t.value)){const _=t.dataset.errorMessage||"Только буквы, пробелы и дефисы";S(e,t,_,n);return}if(i&&!/^(https?:\/\/)?([\da-z.-]+)\.[a-z]{2,6}[\/\w .-]*\.(jpg|jpeg|png|gif|svg|webp)$/i.test(t.value)){S(e,t,"Нужна ссылка на картинку",n);return}V(e,t,n)}function ae(e,t){return Array.from(e.querySelectorAll(t.inputSelector)).some(o=>!o.validity.valid)}function R(e,t){const n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass)}function ue(e,t){const n=e.querySelector(t.submitButtonSelector);n.disabled=!1,n.classList.remove(t.inactiveButtonClass)}function K(e,t){ae(e,t)?R(e,t):ue(e,t)}function pe(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{o.addEventListener("input",()=>{ie(e,o,t),K(e,t)})})}function I(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>V(e,o,t)),R(e,t)}function de(e){document.querySelectorAll(e.formSelector).forEach(n=>{n.querySelectorAll(e.inputSelector).forEach(r=>r.removeEventListener("input",()=>{})),pe(n,e),K(n,e)})}const _e=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),v=(e,t)=>{const o=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},x=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),me=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),Z=document.querySelector(".places__list"),$=document.querySelector(".popup_type_edit"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),U=document.querySelector(".popup_type_edit-avatar"),w=document.querySelector(".popup_type_info"),f=$.querySelector(".popup__form"),G=f.querySelector(".popup__input_type_name"),Q=f.querySelector(".popup__input_type_description"),a=A.querySelector(".popup__form"),fe=a.querySelector(".popup__input_type_card-name"),he=a.querySelector(".popup__input_type_url"),m=U.querySelector(".popup__form"),Se=m.querySelector(".popup__input_type_avatar"),M=T.querySelector(".popup__image"),ve=T.querySelector(".popup__caption"),j=w.querySelector(".popup__info"),k=w.querySelector(".popup__list"),b=f.querySelector(".popup__button"),L=a.querySelector(".popup__button"),C=m.querySelector(".popup__button");let g;const W=({name:e,link:t})=>{M.src=t,M.alt=e,ve.textContent=e,y(T)},be=e=>{e.preventDefault(),b.textContent="Сохранение...",b.disabled=!0,te({name:G.value,about:Q.value}).then(t=>{x.textContent=t.name,P.textContent=t.about,p($)}).catch(t=>{console.error(t)}).finally(()=>{b.textContent="Сохранить",b.disabled=!1})},Le=e=>{e.preventDefault(),L.textContent="Создание...",L.disabled=!0,oe({name:fe.value,link:he.value}).then(t=>{const n=H(t,{handleLikeClick:X,handleDeleteClick:Y,handleImageClick:W,handleInfoClick:D},g);Z.prepend(n),p(A),a.reset()}).catch(t=>{console.error(t)}).finally(()=>{L.textContent="Создать",L.disabled=!1})},Ce=e=>{e.preventDefault(),C.textContent="Сохранение...",C.disabled=!0,ne({avatar:Se.value}).then(t=>{B.style.backgroundImage=`url(${t.avatar})`,p(U)}).catch(t=>{console.error(t)}).finally(()=>{C.textContent="Сохранить",C.disabled=!1})},X=(e,t,n)=>{const o=t.classList.contains("card__like-button_is-active");se(e,o).then(r=>{t.classList.toggle("card__like-button_is-active",!o),n.textContent=r.likes.length}).catch(r=>{console.error(r)})},Y=(e,t)=>{confirm("Вы уверены, что хотите удалить эту карточку?")&&re(e).then(()=>{t.remove()}).catch(n=>{console.error(n)})},D=e=>{j.innerHTML="",k.innerHTML="",z().then(t=>{const n=t.find(o=>o._id===e);if(!n)throw new Error("Карточка не найдена");if(j.append(v("Описание:",n.name),v("Дата создания:",_e(n.createdAt)),v("Владелец:",n.owner.name),v("Количество лайков:",String(n.likes.length))),n.likes.length>0)n.likes.forEach(o=>{const s=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0);s.querySelector(".popup__list-item").textContent=o.name,k.append(s)});else{const o=document.createElement("li");o.classList.add("popup__list-item"),o.textContent="Никто ещё не лайкнул эту карточку",k.append(o)}y(w)}).catch(t=>{console.error("Ошибка при загрузке информации о карточке:",t),alert("Не удалось загрузить информацию о карточке")})};me.addEventListener("click",()=>{G.value=x.textContent,Q.value=P.textContent,I(f,q),y($)});ye.addEventListener("click",()=>{a.reset(),I(a,q),y(A)});B.addEventListener("click",()=>{m.reset(),I(m,q),y(U)});const q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};de(q);document.querySelectorAll(".popup").forEach(e=>{le(e)});Promise.all([z(),ee()]).then(([e,t])=>{g=t._id,x.textContent=t.name,P.textContent=t.about,B.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{const o=H(n,{handleLikeClick:X,handleDeleteClick:Y,handleImageClick:W,handleInfoClick:D},g);Z.append(o)})}).catch(e=>{console.error("Ошибка загрузки данных:",e)});f.addEventListener("submit",be);a.addEventListener("submit",Le);m.addEventListener("submit",Ce);
